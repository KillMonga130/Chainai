# Quick Start: JWT Server Setup

## Step 1: Install Backend Dependencies

```powershell
cd backend
npm install
```

## Step 2: Start the JWT Server

```powershell
npm start
```

The server will:
- Start on http://localhost:3003
- Generate RSA key pair
- **Display a PUBLIC KEY** in the console

## Step 3: Copy the Public Key to watsonx Orchestrate

1. **Copy the entire public key** from the terminal (including the `-----BEGIN PUBLIC KEY-----` and `-----END PUBLIC KEY-----` lines)

2. **Log into watsonx Orchestrate**:
   - Go to: https://us-south.watson-orchestrate.cloud.ibm.com
   - Navigate to: **Settings → Security → Embedded Chat**
   - Find the **Public Key** field
   - Paste the public key
   - Click **Save**

## Step 4: Re-enable Security on Your Instance

Since you previously disabled security, you need to enable it again:

```bash
cd path/to/wxO-embed-chat-security-tool
./wxO-embed-chat-security-tool.sh
```

When prompted:
- Choose to **ENABLE** security (not disable)
- Follow the prompts to configure security settings

## Step 5: Start Your React App

```powershell
# In a new terminal, go back to project root
cd ..
npm run dev
```

## Step 6: Test the Chat

1. Open http://localhost:3000 (or whatever port Vite uses)
2. Click on any agent
3. The chat should now connect successfully!

## What's Happening?

1. Your React app requests a JWT from `http://localhost:3003/createJWT`
2. The backend generates a signed JWT using the private key
3. Your React app passes this JWT to watsonx Orchestrate
4. watsonx Orchestrate validates the JWT signature using the public key you uploaded
5. If valid, the chat connects and works!

## Troubleshooting

### Chat still stuck on "Connecting..."
- Verify the public key was uploaded to watsonx Orchestrate correctly
- Check that security is ENABLED on your instance (not disabled)
- Ensure the JWT server is running on port 3003
- Check browser console for any errors

### "Failed to fetch JWT"
- Make sure the backend server is running
- Check that port 3003 is not blocked
- Verify CORS is allowing your frontend origin

### "Invalid token" errors
- The public key in watsonx Orchestrate must match the one generated by the server
- If you restart the server, it generates a NEW key pair - you'll need to update watsonx Orchestrate

## Production Considerations

For production deployment:

1. **Generate persistent keys**: Store RSA keys in secure files instead of generating on startup
2. **Use environment variables**: Don't hardcode keys in the server
3. **Add authentication**: Protect the `/createJWT` endpoint
4. **Use HTTPS**: Deploy with SSL certificates
5. **Add rate limiting**: Prevent token abuse
6. **Log securely**: Monitor JWT generation for security

## Files Created

- `backend/package.json` - Dependencies
- `backend/server.js` - JWT generation server
- Updated `.env.local` - Configured to use JWT server
- Updated `src/services/watsonx-auth.ts` - Added JWT server support
